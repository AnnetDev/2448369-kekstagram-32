(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();const te=document.querySelector("#picture").content.querySelector(".picture"),ne=({url:e,description:t,likes:n,comments:o,id:r})=>{const c=te.cloneNode(!0);return c.querySelector(".picture__img").src=e,c.querySelector(".picture__img").alt=t,c.querySelector(".picture__likes").textContent=n,c.querySelector(".picture__comments").textContent=o.length,c.dataset.thumbnailId=r,c},v=(e,t)=>{const n=document.createDocumentFragment();e.forEach(o=>{const r=ne(o);n.append(r)}),t.append(n)},s=document.querySelector(".big-picture"),w=s.querySelector(".social__comment-count"),N=s.querySelector(".social__comments"),_=s.querySelector(".comments-loader"),oe=w.querySelector(".social__comment-shown-count"),re=w.querySelector(".social__comment-total-count"),ce=s.querySelector(".big-picture__cancel"),I=document.querySelector("body"),se=document.querySelector("#comment").content.querySelector(".social__comment"),ie=5;let d=0,S=[];const le=e=>e.key==="Escape",ae=({avatar:e,name:t,message:n})=>{const o=se.cloneNode(!0);return o.querySelector(".social__picture").src=e,o.querySelector(".social__picture").alt=t,o.querySelector(".social__text").textContent=n,o},ue=e=>{d=0,S=e,N.innerHTML="",U()},O=()=>{s.classList.add("hidden"),I.classList.remove("modal-open"),document.removeEventListener("keydown",M)};function M(e){le(e)&&(e.preventDefault(),O())}const de=()=>{O()},me=({url:e,likes:t,description:n})=>{s.querySelector(".big-picture__img img").src=e,s.querySelector(".big-picture__img img").alt=n,s.querySelector(".likes-count").textContent=t,s.querySelector(".social__caption").textContent=n},fe=e=>{s.classList.remove("hidden"),I.classList.add("modal-open"),_.classList.remove("hidden"),w.classList.remove("hidden"),document.addEventListener("keydown",M),me(e),ue(e.comments)};function U(){const e=document.createDocumentFragment(),t=S.slice(d,d+ie);t.forEach(n=>{const o=ae(n);e.append(o)}),N.append(e),d+=t.length,pe(),d>=S.length?_.classList.add("hidden"):_.classList.remove("hidden")}function pe(){oe.textContent=d,re.textContent=S.length}ce.addEventListener("click",de);_.addEventListener("click",U);const q=document.querySelector(".pictures"),ge=document.querySelector(".img-filters"),ye=()=>{q.querySelectorAll(".picture").forEach(t=>t.remove())},he=e=>{q.addEventListener("click",t=>{const n=t.target.closest("[data-thumbnail-id]");if(!n)return;t.preventDefault();const o=e.find(r=>r.id===+n.dataset.thumbnailId);fe(o)}),v(e,q),ge.classList.remove("img-filters--inactive")},$=25,_e=25,Se=100,B=100,Ee=document.querySelector(".scale__control--smaller"),ve=document.querySelector(".scale__control--bigger"),Le=document.querySelector(".scale__control--value"),G=document.querySelector(".img-upload__preview img");let m=B;const R=()=>{Le.value=`${m}%`,G.style.transform=`scale(${m/100})`};Ee.addEventListener("click",()=>{m>_e&&(m-=$,R())});ve.addEventListener("click",()=>{m<Se&&(m+=$,R())});const qe=()=>{G.style.transform=`scale(${B/100})`},L={none:{style:"none",step:.1,unit:"",min:0,max:1},chrome:{style:"grayscale",step:.1,unit:"",min:0,max:1},sepia:{style:"sepia",step:.1,unit:"",min:0,max:1},marvin:{style:"invert",step:1,unit:"%",min:0,max:100},phobos:{style:"blur",step:.1,unit:"px",min:0,max:3},heat:{style:"brightness",step:.1,unit:"",min:1,max:3}},y=document.querySelector(".img-upload__form"),E=y.querySelector(".img-upload__preview img"),H=y.querySelector(".effects"),be=y.querySelector(".effect-level__value"),K=y.querySelector(".img-upload__effect-level"),u=y.querySelector(".effect-level__slider");let a=L.none;const we=({min:e,max:t,step:n})=>{u.noUiSlider||(noUiSlider.create(u,{start:t,range:{min:e,max:t},step:n,format:{to:o=>Number(o),from:o=>Number(o)}}),u.noUiSlider.on("update",Te)),j()},Ce=(e,t)=>{e==="none"?E.style.filter="":E.style.filter=`${e.style}(${t}${e.unit})`};function Te(){const e=u.noUiSlider.get();be.value=e,Ce(a,e)}const V=e=>{const t=e.target.closest('input[type="radio"]');if(t){const n=t.value;a=L[n],n==="none"?(j(),E.style.filter=""):(Pe(),u.noUiSlider.updateOptions({range:{min:a.min,max:a.max},start:a.max,step:a.step}))}};function j(){K.classList.add("hidden")}function Pe(){K.classList.remove("hidden")}const De=()=>{we(L.none),H.addEventListener("change",V)},ke=()=>{u.noUiSlider&&u.noUiSlider.destroy(),E.style.filter="",a=L.none,H.removeEventListener("change",V)},xe="https://32.javascript.htmlacademy.pro/kekstagram",z={GET_DATA:"/data",SEND_DATA:"/"},W={GET:"GET",POST:"POST"},X=(e,t=W.GET,n=null)=>fetch(`${xe}${e}`,{method:t,body:n}).then(o=>{if(!o.ok)throw new Error(`Произошла ошибка ${o.status}: ${o.statusText}`);return o.json()}),Ae=()=>X(z.GET_DATA),Fe=e=>X(z.SEND_DATA,W.POST,e),Ne=["jpg","jpeg","png"],Y={IDLE:"Опубликовать",SENDING:"Публикую..."},b=document.querySelector(".img-upload__input[type=file]"),J=document.querySelector(".img-upload__preview img"),C=document.querySelector(".img-upload__overlay"),Q=document.body,Ie=C.querySelector(".img-upload__cancel"),p=document.querySelector(".img-upload__form"),T=p.querySelector(".text__hashtags"),P=p.querySelector(".text__description"),f=p.querySelector(".img-upload__submit");b.addEventListener("change",()=>{Oe();const e=b.files[0],t=e.name.toLowerCase();if(Ne.some(o=>t.endsWith(o))){const o=URL.createObjectURL(e);J.src=o,document.querySelectorAll(".effects__preview").forEach(c=>{c.style.backgroundImage=`url(${o})`})}});function Oe(){C.classList.remove("hidden"),Q.classList.add("modal-open"),document.addEventListener("keydown",Z),De()}const D=e=>e.key==="Escape";function k(){C.classList.add("hidden"),Q.classList.remove("modal-open"),document.removeEventListener("keydown",Z),Me(),qe(),ke()}function Z(e){if(D(e)){if(document.activeElement===T||document.activeElement===P){e.stopPropagation();return}const t=document.querySelector(".error");if(t){e.preventDefault(),t.remove(),e.stopPropagation();return}e.preventDefault(),k()}}function Me(){b.value="",p.reset(),J.src="",document.querySelectorAll(".effects__preview").forEach(t=>{t.style.backgroundImage=""}),x()}Ie.addEventListener("click",k);const h=new Pristine(p,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper",errorTextClass:"img-upload__field-wrapper__error"});function x(){h.reset(),document.querySelectorAll(".pristine-error").forEach(t=>t.remove())}function Ue(e){return e.length<=140}h.addValidator(P,Ue);function $e(e){if(!e)return!0;const t=e.trim().split(/\s+/);if(t.length>5)return!1;const n=/^#[a-za-яё0-9]{1,19}$/i,o=new Set;for(const r of t){if(r.length>20||!n.test(r)||o.has(r.toLowerCase()))return!1;o.add(r.toLowerCase())}return!0}function Be(e){const t=e.trim().split(/\s+/);if(t.length>5)return"Нельзя указать больше пяти хэштегов";const n=/^#[a-za-яё0-9]{1,19}$/i,o=new Set;for(const r of t){if(r.length>20)return"Максимум 20 символов";if(!n.test(r))return"Хэштег должен начинаться с # и содержать только буквы и цифры";if(o.has(r.toLowerCase()))return"Один и тот же хэштег не может быть использован дважды";o.add(r.toLowerCase())}}h.addValidator(T,$e,Be);const Ge=()=>{f.disabled=!0,f.textContent=Y.SENDING},Re=()=>{f.disabled=!1,f.textContent=Y.IDLE},He=()=>{const t=document.querySelector("#success").content.cloneNode(!0);document.body.append(t);const n=document.querySelector(".success__button"),o=document.querySelector(".success"),r=()=>{o.remove(),document.removeEventListener("keydown",c),document.removeEventListener("click",i)};function c(l){D(l)&&(l.preventDefault(),r())}function i(l){l.target.closest(".success__inner")||r()}n.addEventListener("click",r),document.addEventListener("keydown",c),document.addEventListener("click",i)},Ke=()=>{const t=document.querySelector("#error").content.cloneNode(!0);document.body.append(t);const n=document.querySelector(".error__button"),o=document.querySelector(".error"),r=()=>{o.remove(),document.removeEventListener("keydown",c),document.removeEventListener("click",i)};function c(l){D(l)&&(l.preventDefault(),r())}function i(l){l.target.closest(".error__inner")||r()}n.addEventListener("click",r),document.addEventListener("keydown",c),document.addEventListener("click",i)},Ve=e=>{p.addEventListener("submit",async t=>{t.preventDefault(),h.validate()&&(Ge(),await Fe(new FormData(t.target)).then(()=>{e(),He()}).catch(()=>{Ke()}).finally(Re))})};function ee(){h.validate()?f.removeAttribute("disabled"):f.setAttribute("disabled",!0)}T.addEventListener("input",()=>{x(),ee()});P.addEventListener("input",()=>{x(),ee()});const je=5e3,ze=()=>{const t=document.querySelector("#data-error").content.cloneNode(!0);document.body.append(t),setTimeout(()=>{document.querySelector(".data-error").remove()},je)};function We(e,t=500){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,o),t)}}const Xe=10;let g=[];const Ye=document.querySelector(".img-filters__form"),A=document.querySelector(".pictures");let F=document.querySelector(".img-filters__button--active");const Je=()=>{v(g,A)},Qe=()=>{const e=[],t=new Set;for(;e.length<Xe;){const n=Math.floor(Math.random()*g.length);t.has(n)||(e.push(g[n]),t.add(n))}v(e,A)},Ze=()=>{const e=[...g].sort((t,n)=>n.comments.length-t.comments.length);v(e,A)},et={"filter-default":Je,"filter-random":Qe,"filter-discussed":Ze};function tt(e){ye();const t=et[e];t&&t()}const nt=We(tt,500);function ot(e){e.target.classList.contains("img-filters__button")&&(F.classList.remove("img-filters__button--active"),e.target.classList.add("img-filters__button--active"),F=e.target,nt(e.target.id))}function rt(e){g=e,Ye.addEventListener("click",ot)}Ae().then(e=>{he(e),rt(e)}).catch(()=>{ze()});Ve(k);
